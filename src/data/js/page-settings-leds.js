(()=>{var x=Object.defineProperty;var E=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var C=(e,t,s)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,P=(e,t)=>{for(var s in t||(t={}))A.call(t,s)&&C(e,s,t[s]);if(E)for(var s of E(t))I.call(t,s)&&C(e,s,t[s]);return e};async function S(){try{let e=await fetch("/api/config");if(!e.ok)throw new Error(`Config API returned ${e.status}: ${e.statusText}`);return await e.json()}catch(e){throw console.error("API: Failed to load configuration:",e),e}}async function T(e){try{let t=await fetch("/api/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let s=await t.text();throw console.error("API: Server error response:",s),new Error(`Server error: ${t.status} - ${s}`)}return"Configuration saved"}catch(t){throw console.error("API: Failed to save configuration:",t),t}}async function v(e,t=1e4,s=null){try{let o;typeof e=="object"&&e.effect?o=e:typeof e=="string"&&typeof t=="object"?o=P({effect:e},t):(o={effect:e,duration:t},s&&Object.keys(s).length>0&&(o.settings=s));let i=await fetch("/api/leds/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);return}catch(o){throw console.error("API: Failed to trigger LED effect:",o),o}}async function b(){try{let e=await fetch("/api/leds/off",{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return}catch(e){throw console.error("API: Failed to turn off LEDs:",e),e}}function k(){return{loaded:!1,error:null,saving:!1,initialized:!1,config:{},effect:null,speed:null,intensity:null,cycles:null,colors:[],originalConfig:{},testingEffect:!1,colorPresets:["#0062ff","#ff0000","#00ff00","#ff00ff","#ffff00","#00ffff"],get canSave(){return!this.saving&&this.loaded&&!this.error&&this.hasChanges},get hasChanges(){var s,o,i,n,a,c;let e={count:(s=this.config.leds)==null?void 0:s.count,brightness:(o=this.config.leds)==null?void 0:o.brightness,refreshRate:(i=this.config.leds)==null?void 0:i.refreshRate},t={count:(n=this.originalConfig.leds)==null?void 0:n.count,brightness:(a=this.originalConfig.leds)==null?void 0:a.brightness,refreshRate:(c=this.originalConfig.leds)==null?void 0:c.refreshRate};return JSON.stringify(e)!==JSON.stringify(t)},async loadConfiguration(){var e,t,s,o,i,n,a,c,f,l,h,d,g,u,p,w,y,m;if(!this.initialized){this.initialized=!0,this.loaded=!1,this.error=null;try{let r=await S();this.config.leds={gpio:(t=(e=r.leds)==null?void 0:e.gpio)!=null?t:-1,count:(o=(s=r.leds)==null?void 0:s.count)!=null?o:30,effect:(n=(i=r.leds)==null?void 0:i.effect)!=null?n:"chase_single",brightness:(c=(a=r.leds)==null?void 0:a.brightness)!=null?c:128,refreshRate:(l=(f=r.leds)==null?void 0:f.refreshRate)!=null?l:60,speed:(d=(h=r.leds)==null?void 0:h.speed)!=null?d:50,intensity:(u=(g=r.leds)==null?void 0:g.intensity)!=null?u:50,cycles:(w=(p=r.leds)==null?void 0:p.cycles)!=null?w:3,colors:(m=(y=r.leds)==null?void 0:y.colors)!=null?m:["#0062ff","#ff0000","#00ff00"]},this.originalConfig={leds:JSON.parse(JSON.stringify(this.config.leds))},(!Array.isArray(this.colors)||this.colors.length<3)&&(this.colors=["#0062ff","#ff0000","#00ff00"]),this.loaded=!0}catch(r){this.error=`Failed to load configuration: ${r.message}`}}},async saveConfiguration(){if(this.canSave){this.saving=!0,this.error=null;try{let e={leds:{count:this.config.leds.count,brightness:this.config.leds.brightness,refreshRate:this.config.leds.refreshRate}};console.log("Saving partial LED configuration:",e);let t=await T(e);this.originalConfig.leds=this.originalConfig.leds||{},this.originalConfig.leds.count=this.config.leds.count,this.originalConfig.leds.brightness=this.config.leds.brightness,this.originalConfig.leds.refreshRate=this.config.leds.refreshRate,window.location.href="/settings/?saved=leds"}catch(e){console.error("Error saving configuration:",e),this.error=e.message||"Failed to save configuration",this.showErrorMessage(this.error),this.saving=!1}}},cancelConfiguration(){window.location.href="/settings/"},showColorControls(){return this.config.leds&&(this.effect==="chase_single"||this.effect==="chase_multi"||this.effect==="matrix"||this.effect==="twinkle"||this.effect==="pulse")},updateEffectParams(){this.effect==="chase_single"?this.colors=["#0062ff"]:this.effect==="chase_multi"?this.colors=["#ff0000","#00ff00","#0000ff"]:this.effect==="matrix"?this.colors=["#00ff00"]:this.effect==="twinkle"?this.colors=["#ffff00"]:this.effect==="pulse"?this.colors=["#800080"]:this.effect==="rainbow"&&(this.colors=[])},async testLedEffect(){if(!this.testingEffect){this.testingEffect=!0;try{let e=this.colors||["#0062ff"];this.effect==="chase_single"||this.effect==="matrix"||this.effect==="twinkle"||this.effect==="pulse"?e=[e[0]]:this.effect==="chase_multi"?e=e.slice(0,3):this.effect==="rainbow"&&(e=[]);let t={effect:this.effect,speed:this.speed||50,intensity:this.intensity||50,cycles:this.cycles||3,colors:e};console.log("Testing LED effect:",t),await v(t)}catch(e){console.error("Failed to test LED effect:",e),this.showErrorMessage("Failed to test LED effect: "+e.message)}finally{this.testingEffect=!1}}},async turnOffLeds(){try{console.log("Turning off LEDs"),await b()}catch(e){console.error("Failed to turn off LEDs:",e),this.showErrorMessage("Failed to turn off LEDs: "+e.message)}},showErrorMessage(e){let t=document.createElement("div");t.className="fixed top-4 right-4 bg-red-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.style.opacity="0",setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300)},5e3)}}}document.addEventListener("alpine:init",()=>{let e=k();Alpine.store("settingsLeds",e),console.log("\u2705 LEDs Settings Store registered with ES6 modules")});})();
