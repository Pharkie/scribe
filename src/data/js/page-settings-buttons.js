(()=>{async function Lt(){try{let t=await fetch("/api/config");if(!t.ok)throw new Error(`Config API returned ${t.status}: ${t.statusText}`);return await t.json()}catch(t){throw console.error("API: Failed to load configuration:",t),t}}async function qt(t){try{let n=await fetch("/api/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok){let r=await n.text();throw console.error("API: Server error response:",r),new Error(`Server error: ${n.status} - ${r}`)}return"Configuration saved"}catch(n){throw console.error("API: Failed to save configuration:",n),n}}function $t(){return{loaded:!1,error:null,saving:!1,initialized:!1,config:{},originalConfig:{},validationErrors:{},get canSave(){return!this.saving&&this.loaded&&!this.error&&this.hasChanges&&!this.hasValidationErrors},get hasChanges(){return JSON.stringify(this.config.buttons)!==JSON.stringify(this.originalConfig.buttons)},get hasValidationErrors(){return this.validationErrors&&Object.keys(this.validationErrors).length>0},async loadConfiguration(){var t,n,r,s,e,i,a,c,u,l,f,h,d,g,b,p,w,y,T,m,E,v,A,S,P,C,M,k,I,x,L,q,$,O,F,j,J,N,D,V,W,z,B,H,G,U,Y,K,Q,R,X,Z,_,tt,ot,nt,rt,et,st,it,at,ct,ut,lt,ft,ht,dt,gt,bt,pt,wt,yt,Tt,mt,Et,vt,At,St,Pt,Ct,Mt,kt,It,xt;if(!this.initialized){this.initialized=!0,this.loaded=!1,this.error=null;try{let o=await Lt();this.config.buttons={button1:{gpio:(r=(n=(t=o.buttons)==null?void 0:t.button1)==null?void 0:n.gpio)!=null?r:-1,shortAction:(i=(e=(s=o.buttons)==null?void 0:s.button1)==null?void 0:e.shortAction)!=null?i:"",longAction:(u=(c=(a=o.buttons)==null?void 0:a.button1)==null?void 0:c.longAction)!=null?u:"",shortMqttTopic:(h=(f=(l=o.buttons)==null?void 0:l.button1)==null?void 0:f.shortMqttTopic)!=null?h:"",longMqttTopic:(b=(g=(d=o.buttons)==null?void 0:d.button1)==null?void 0:g.longMqttTopic)!=null?b:"",shortLedEffect:(y=(w=(p=o.buttons)==null?void 0:p.button1)==null?void 0:w.shortLedEffect)!=null?y:"none",longLedEffect:(E=(m=(T=o.buttons)==null?void 0:T.button1)==null?void 0:m.longLedEffect)!=null?E:"none"},button2:{gpio:(S=(A=(v=o.buttons)==null?void 0:v.button2)==null?void 0:A.gpio)!=null?S:-1,shortAction:(M=(C=(P=o.buttons)==null?void 0:P.button2)==null?void 0:C.shortAction)!=null?M:"",longAction:(x=(I=(k=o.buttons)==null?void 0:k.button2)==null?void 0:I.longAction)!=null?x:"",shortMqttTopic:($=(q=(L=o.buttons)==null?void 0:L.button2)==null?void 0:q.shortMqttTopic)!=null?$:"",longMqttTopic:(j=(F=(O=o.buttons)==null?void 0:O.button2)==null?void 0:F.longMqttTopic)!=null?j:"",shortLedEffect:(D=(N=(J=o.buttons)==null?void 0:J.button2)==null?void 0:N.shortLedEffect)!=null?D:"none",longLedEffect:(z=(W=(V=o.buttons)==null?void 0:V.button2)==null?void 0:W.longLedEffect)!=null?z:"none"},button3:{gpio:(G=(H=(B=o.buttons)==null?void 0:B.button3)==null?void 0:H.gpio)!=null?G:-1,shortAction:(K=(Y=(U=o.buttons)==null?void 0:U.button3)==null?void 0:Y.shortAction)!=null?K:"",longAction:(X=(R=(Q=o.buttons)==null?void 0:Q.button3)==null?void 0:R.longAction)!=null?X:"",shortMqttTopic:(tt=(_=(Z=o.buttons)==null?void 0:Z.button3)==null?void 0:_.shortMqttTopic)!=null?tt:"",longMqttTopic:(rt=(nt=(ot=o.buttons)==null?void 0:ot.button3)==null?void 0:nt.longMqttTopic)!=null?rt:"",shortLedEffect:(it=(st=(et=o.buttons)==null?void 0:et.button3)==null?void 0:st.shortLedEffect)!=null?it:"none",longLedEffect:(ut=(ct=(at=o.buttons)==null?void 0:at.button3)==null?void 0:ct.longLedEffect)!=null?ut:"none"},button4:{gpio:(ht=(ft=(lt=o.buttons)==null?void 0:lt.button4)==null?void 0:ft.gpio)!=null?ht:-1,shortAction:(bt=(gt=(dt=o.buttons)==null?void 0:dt.button4)==null?void 0:gt.shortAction)!=null?bt:"",longAction:(yt=(wt=(pt=o.buttons)==null?void 0:pt.button4)==null?void 0:wt.longAction)!=null?yt:"",shortMqttTopic:(Et=(mt=(Tt=o.buttons)==null?void 0:Tt.button4)==null?void 0:mt.shortMqttTopic)!=null?Et:"",longMqttTopic:(St=(At=(vt=o.buttons)==null?void 0:vt.button4)==null?void 0:At.longMqttTopic)!=null?St:"",shortLedEffect:(Mt=(Ct=(Pt=o.buttons)==null?void 0:Pt.button4)==null?void 0:Ct.shortLedEffect)!=null?Mt:"none",longLedEffect:(xt=(It=(kt=o.buttons)==null?void 0:kt.button4)==null?void 0:It.longLedEffect)!=null?xt:"none"}},this.originalConfig={buttons:JSON.parse(JSON.stringify(this.config.buttons))},this.loaded=!0}catch(o){this.error=`Failed to load configuration: ${o.message}`}}},async saveConfiguration(){if(this.canSave){this.saving=!0,this.error=null;try{let t={buttons:{button1:this.config.buttons.button1,button2:this.config.buttons.button2,button3:this.config.buttons.button3,button4:this.config.buttons.button4}};console.log("Saving partial button configuration:",t);let n=await qt(t);this.originalConfig.buttons=JSON.parse(JSON.stringify(this.config.buttons)),window.location.href="/settings/?saved=buttons"}catch(t){console.error("Error saving configuration:",t),this.error=t.message||"Failed to save configuration",this.showErrorMessage(this.error),this.saving=!1}}},cancelConfiguration(){window.location.href="/settings/"},isValidMqttTopic(t){return t?!(t.length>65535||t.includes("#")||t.includes("+")||t.startsWith("$SYS")||t.includes("\0")||t.trim()!==t):!0},validateMqttTopic(t,n,r){let s=this.isValidMqttTopic(t),e=`mqtt-${n}-${r}`;return!s&&t?(this.validationErrors=this.validationErrors||{},this.validationErrors[e]="Invalid MQTT topic format",!1):(this.validationErrors&&delete this.validationErrors[e],!0)},showErrorMessage(t){let n=document.createElement("div");n.className="fixed top-4 right-4 bg-red-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300",n.textContent=t,document.body.appendChild(n),setTimeout(()=>{n.style.opacity="0",setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},300)},5e3)}}}document.addEventListener("alpine:init",()=>{let t=$t();Alpine.store("settingsButtons",t),console.log("\u2705 Buttons Settings Store registered with ES6 modules")});})();
