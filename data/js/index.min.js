function initializeIndexUI(){const e=document.getElementById("message-textarea");e&&(e.addEventListener("input",()=>updateCharacterCount("message-textarea","char-counter",MAX_CHARS)),updateCharacterCount("message-textarea","char-counter",MAX_CHARS))}function initializePrinterSelection(){const e=document.getElementById("printer-selection");if(!e)return;e.innerHTML="";const r=createPrinterOption("local-direct","🖨️",`Local direct (${window.GLOBAL_CONFIG?.printer?.name||"Unknown"})`,!0,null);e.appendChild(r),"undefined"!=typeof PRINTERS&&PRINTERS.forEach(r=>{const t=createPrinterOption(`scribe/${r.name}/print`,"📡",`${r.name} via MQTT`,!1,r);e.appendChild(t)})}function createPrinterOption(e,r,t,n=!1,a=null){const o=document.createElement("div");o.className="printer-option cursor-pointer p-4 rounded-xl border-2 transition-all duration-200 hover:scale-105 hover:shadow-md "+(n?"border-orange-400 bg-orange-50 dark:bg-orange-900/20 text-orange-700 dark:text-orange-300 dark:border-orange-600":"border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500"),o.setAttribute("data-value",e);let d="Unknown",i="";if("local-direct"===e)d="Direct connection";else if("local-mqtt"===e)d="MQTT connection";else if(d="MQTT connection",a){const e=[];if(a.ip_address&&e.push(`IP: ${a.ip_address}`),a.firmware_version&&e.push(`v${a.firmware_version}`),void 0!==a.last_seen){const r=0===a.last_seen?"Just now":`${a.last_seen}s ago`;e.push(`Seen: ${r}`)}e.length>0&&(i=` • ${e.join(" • ")}`)}return o.innerHTML=`\n    <div class="flex items-center space-x-3">\n      <span class="text-2xl">${r}</span>\n      <div class="flex-1 min-w-0">\n        <div class="font-medium text-sm truncate">${t}</div>\n        <div class="text-xs text-gray-500 dark:text-gray-400 truncate">${d}${i}</div>\n      </div>\n    </div>\n  `,o.addEventListener("click",()=>selectPrinter(e,o)),o}function selectPrinter(e,r){document.querySelectorAll(".printer-option").forEach(e=>{e.className=e.className.replace(/border-orange-400|bg-orange-50|text-orange-700|dark:bg-orange-900\/20|dark:text-orange-300|dark:border-orange-600/g,"").replace(/border-gray-200|bg-gray-50|text-gray-700|dark:border-gray-600|dark:bg-gray-700|dark:text-gray-300/g,"")+" border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500"}),r.className=r.className.replace(/border-gray-200|bg-gray-50|text-gray-700|hover:border-gray-300|dark:border-gray-600|dark:bg-gray-700|dark:text-gray-300|dark:hover:border-gray-500/g,"")+" border-orange-400 bg-orange-50 dark:bg-orange-900/20 text-orange-700 dark:text-orange-300 dark:border-orange-600";const t=document.getElementById("printer-target");t&&(t.value=e)}function initializeConfigDependentUI(){initializePrinterSelection()}function updateCharacterCount(e,r,t=1e3){const n=document.getElementById(e),a=document.getElementById(r);if(n&&a){const e=n.value.length,r=t;a.textContent=`${e}/${r} characters`;const o=a.parentElement;o&&(o.classList.remove("text-gray-500","text-yellow-700","text-red-600","dark:text-gray-400","dark:text-yellow-300","dark:text-red-400"),e>r?o.classList.add("text-red-600","dark:text-red-400"):e>=.8*r?o.classList.add("text-yellow-700","dark:text-yellow-300"):o.classList.add("text-gray-500","dark:text-gray-400"))}}function goToSettings(){window.location.href="/settings.html"}document.addEventListener("DOMContentLoaded",function(){initializeIndexUI(),initializeConfigDependentUI(),document.addEventListener("printersUpdated",function(e){console.log("🔄 Printers updated, refreshing index page printer selection"),initializePrinterSelection()})});