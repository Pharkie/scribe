<!DOCTYPE html>
<html lang="en" class="app-root">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Scribe - Diagnostics</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/diagnostics.min.css">
</head>

<body class="page-body">
    <main class="page-main">
        <header class="page-header">
            <div class="header-spacer">
                <button id="back-button" class="back-button">
                    <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7">
                        </path>
                    </svg>
                    <span class="text-xs sm:text-sm font-medium">Back</span>
                </button>
            </div>
            <div class="header-center">
                <h1 class="page-title">
                    <span class="text-4xl sm:text-5xl">üõ†Ô∏è</span>
                    <span>Diagnostics</span>
                </h1>
            </div>
            <div class="header-spacer"></div>
        </header>
        <nav class="flex flex-wrap justify-center gap-2 mb-6">
            <button data-section="device-config-section" class="section-nav-btn section-nav-btn-purple active">‚öôÔ∏è
                Device</button>
            <button data-section="network-section" class="section-nav-btn section-nav-btn-blue">üåê
                Network</button>
            <button data-section="mqtt-section" class="section-nav-btn section-nav-btn-green">üì° MQTT</button>
            <button data-section="microcontroller-section" class="section-nav-btn section-nav-btn-orange">üéõÔ∏è
                Microcontroller</button>
            <button data-section="unbidden-ink-section" class="section-nav-btn section-nav-btn-yellow">üé≤
                Unbidden Ink</button>
            <button data-section="logging-section" class="section-nav-btn section-nav-btn-indigo">üìã
                Logging</button>
            <button data-section="hardware-buttons-section" class="section-nav-btn section-nav-btn-pink">üéõÔ∏è
                Buttons</button>
            <button data-section="pages-endpoints-section" class="section-nav-btn section-nav-btn-teal">üîó
                Pages & Endpoints</button>
            <button data-section="config-file-section" class="section-nav-btn section-nav-btn-red">üìÑ Config
                File</button>
        </nav>

        <div id="loading" class="text-center py-8"><span class="text-2xl">‚è≥</span><br>Loading diagnostics...</div>
        <div id="error" class="diag-error"><span class="text-2xl">‚ùå</span>
            <h3 class="text-lg font-semibold mb-2">Error Loading Diagnostics</h3>
            <p id="error-message" class="text-red-600 dark:text-red-400"></p>
        </div>

        <div id="diagnostics-content" class="space-y-6">
            <!-- Device Configuration -->
            <div id="device-config-section" class="diag-section purple">
                <div class="diag-header">
                    <h4 class="diag-title purple"><span class="mr-2">‚öôÔ∏è</span>Device</h4>
                    <button data-section-name="Device" class="diag-copy-btn purple generic-copy-btn">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-2">
                    <div class="diag-row"><span class="diag-label">Device Owner:</span><span class="diag-value"
                            data-field="device-owner">-</span></div>
                    <div class="diag-row"><span class="diag-label">Timezone:</span><span class="diag-value"
                            data-field="timezone">-</span></div>
                    <div class="diag-row flexible"><span class="diag-label">mDNS Hostname:</span><span
                            class="diag-value flexible" data-field="mdns-hostname">-</span></div>
                    <div class="diag-row"><span class="diag-label">Max Message Chars:</span><span class="diag-value"
                            data-field="max-message-chars">-</span></div>
                </div>
            </div>

            <!-- Network -->
            <div id="network-section" class="diag-section blue">
                <div class="diag-header">
                    <h4 class="diag-title blue"><span class="mr-2">üåê</span>Network</h4>
                    <button data-section-name="Network" class="diag-copy-btn blue generic-copy-btn">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-2">
                    <div class="diag-row"><span class="diag-label">WiFi Status:</span><span class="diag-value"
                            data-field="wifi-status">-</span></div>
                    <div class="diag-row flexible"><span class="diag-label">SSID:</span><span
                            class="diag-value flexible" data-field="wifi-ssid">-</span></div>
                    <div class="diag-row"><span class="diag-label">IP Address:</span><span class="diag-value"
                            data-field="ip-address">-</span></div>
                    <div class="diag-row"><span class="diag-label">Signal Strength:</span><span class="diag-value"
                            data-field="signal-strength">-</span></div>
                    <div class="diag-row flexible"><span class="diag-label">MAC Address:</span><span
                            class="diag-value flexible" data-field="mac-address">-</span></div>
                    <div class="diag-row"><span class="diag-label">Gateway:</span><span class="diag-value"
                            data-field="gateway">-</span></div>
                    <div class="diag-row"><span class="diag-label">DNS:</span><span class="diag-value"
                            data-field="dns">-</span></div>
                    <div class="diag-reference blue">
                        <h5 class="diag-reference-title blue"><span class="mr-2">üì°</span>AP Fallback Reference</h5>
                        <div class="diag-reference-box blue">
                            <p class="text-blue-800 dark:text-blue-200 font-medium">If WiFi connection fails, device
                                creates its own network:</p>
                            <div class="space-y-1 text-blue-700 dark:text-blue-300">
                                <div><strong>Connection Timeout:</strong> <span class="font-mono"
                                        data-field="wifi-connect-timeout">15 seconds</span></div>
                                <div><strong>Network Name:</strong> <span class="font-mono">Scribe-setup</span></div>
                                <div><strong>Password:</strong> <span class="font-mono">scribe123</span></div>
                                <div><strong>IP Address:</strong> <span class="font-mono">192.168.4.1</span></div>
                                <div><strong>Setup URL:</strong> <span
                                        class="font-mono">http://192.168.4.1/settings.html</span></div>
                            </div>
                            <p class="text-blue-600 dark:text-blue-400 text-xs mt-2">üí° Connect to this network if you
                                can't reach the device on your main WiFi</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MQTT -->
            <div id="mqtt-section" class="diag-section green">
                <div class="diag-header">
                    <h4 class="diag-title green"><span class="mr-2">üì°</span>MQTT</h4>
                    <button data-section-name="MQTT" class="diag-copy-btn green generic-copy-btn">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-2">
                    <div class="diag-row"><span class="diag-label">MQTT Enabled:</span><span class="diag-value"
                            data-field="mqtt-enabled">-</span></div>
                    <div class="diag-row"><span class="diag-label">Connection Status:</span><span class="diag-value"
                            data-field="mqtt-status">-</span></div>
                    <div class="diag-row flexible"><span class="diag-label">Broker:</span><span
                            class="diag-value flexible" data-field="mqtt-broker">-</span></div>
                    <div class="diag-row"><span class="diag-label">Port:</span><span class="diag-value"
                            data-field="mqtt-port">-</span></div>
                    <div class="diag-row flexible"><span class="diag-label">Topic:</span><span
                            class="diag-value flexible" data-field="mqtt-topic">-</span></div>
                </div>
            </div>

            <!-- Microcontroller -->
            <div id="microcontroller-section" class="diag-section orange">
                <div class="diag-header">
                    <h4 class="diag-title orange"><span class="mr-2">üéõÔ∏è</span>Microcontroller</h4>
                    <button data-section-name="orange" class="diag-copy-btn orange generic-copy-btn">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-2">
                    <div class="diag-row"><span class="diag-label">Chip Model:</span><span class="diag-value"
                            data-field="chip-model">-</span></div>
                    <div class="diag-row"><span class="diag-label">CPU Frequency:</span><span class="diag-value"
                            data-field="cpu-frequency">-</span></div>
                    <div class="diag-row"><span class="diag-label">Flash Size:</span><span class="diag-value"
                            data-field="flash-size">-</span></div>
                    <div class="diag-row"><span class="diag-label">Firmware Version:</span><span class="diag-value"
                            data-field="firmware-version">-</span></div>
                    <div class="diag-row"><span class="diag-label">Uptime:</span><span class="diag-value"
                            data-field="uptime">-</span></div>
                    <div class="diag-row"><span class="diag-label">Temperature:</span><span class="diag-value"
                            data-field="temperature">-</span></div>
                    <div class="diag-memory">
                        <div class="diag-memory-item">
                            <div class="diag-memory-label"><span>Flash Usage</span><span
                                    data-field="flash-usage-text">-</span></div>
                            <div class="diag-progress-container orange">
                                <div class="diag-progress-bar orange" data-field="flash-usage-bar" style="width: 0%">
                                </div>
                            </div>
                        </div>
                        <div class="diag-memory-item">
                            <div class="diag-memory-label"><span>Heap Usage</span><span
                                    data-field="heap-usage-text">-</span></div>
                            <div class="diag-progress-container orange">
                                <div class="diag-progress-bar orange" data-field="heap-usage-bar" style="width: 0%">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Unbidden Ink -->
            <div id="unbidden-ink-section" class="diag-section yellow">
                <div class="diag-header">
                    <h4 class="diag-title yellow"><span class="mr-2">üé≤</span>Unbidden Ink</h4>
                    <button data-section-name="yellow" class="diag-copy-btn yellow generic-copy-btn">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-2">
                    <div class="diag-row"><span class="diag-label">Enabled:</span><span class="diag-value"
                            data-field="unbidden-ink-enabled">-</span></div>
                    <div class="diag-row"><span class="diag-label">Start Hour:</span><span class="diag-value"
                            data-field="unbidden-ink-start-hour">-</span></div>
                    <div class="diag-row"><span class="diag-label">End Hour:</span><span class="diag-value"
                            data-field="unbidden-ink-end-hour">-</span></div>
                    <div class="diag-row"><span class="diag-label">Frequency (minutes):</span><span class="diag-value"
                            data-field="unbidden-ink-frequency">-</span></div>
                    <div class="diag-row"><span class="diag-label">Next Message Time:</span><span class="diag-value"
                            data-field="unbidden-ink-next-message">-</span></div>
                </div>
            </div>

            <!-- Logging -->
            <div id="logging-section" class="diag-section indigo">
                <div class="diag-header">
                    <h4 class="diag-title indigo"><span class="mr-2">üìã</span>Logging</h4>
                    <button data-section-name="indigo" class="diag-copy-btn indigo generic-copy-btn">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-2">
                    <div class="diag-row"><span class="diag-label">Level:</span><span class="diag-value"
                            data-field="log-level">-</span></div>
                    <div class="diag-row"><span class="diag-label">Serial Logging:</span><span class="diag-value"
                            data-field="serial-logging">-</span></div>
                    <div class="diag-row"><span class="diag-label">BetterStack Logging:</span><span class="diag-value"
                            data-field="web-logging">-</span></div>
                    <div class="diag-row"><span class="diag-label">File Logging:</span><span class="diag-value"
                            data-field="file-logging">-</span></div>
                    <div class="diag-row"><span class="diag-label">MQTT Logging:</span><span class="diag-value"
                            data-field="mqtt-logging">-</span></div>
                </div>
            </div>

            <!-- Buttons -->
            <div id="hardware-buttons-section" class="diag-section pink">
                <div class="diag-header">
                    <h4 class="diag-title pink"><span class="mr-2">üéõÔ∏è</span>Buttons</h4>
                    <button data-section-name="pink" class="diag-copy-btn pink generic-copy-btn">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>
                </div>
                <div id="buttons-content" class="space-y-4">
                    <!-- Hardware Configuration Section -->
                    <div class="border-b border-gray-200 dark:border-gray-600 pb-3 mb-3">
                        <h5 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Hardware Configuration
                        </h5>
                        <div class="space-y-1">
                            <div class="diag-row">
                                <span class="diag-label">Buttons:</span>
                                <span class="diag-value" data-field="hw-buttons-count">-</span>
                            </div>
                            <div class="diag-row">
                                <span class="diag-label">Debounce:</span>
                                <span class="diag-value" data-field="hw-buttons-debounce">-</span>
                            </div>
                            <div class="diag-row">
                                <span class="diag-label">Long Press:</span>
                                <span class="diag-value" data-field="hw-buttons-long-press">-</span>
                            </div>
                            <div class="diag-row">
                                <span class="diag-label">Active Low:</span>
                                <span class="diag-value" data-field="hw-buttons-active-low">-</span>
                            </div>
                            <div class="diag-row">
                                <span class="diag-label">Min Interval:</span>
                                <span class="diag-value" data-field="hw-buttons-min-interval">-</span>
                            </div>
                            <div class="diag-row">
                                <span class="diag-label">Max/Minute:</span>
                                <span class="diag-value" data-field="hw-buttons-max-per-minute">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Individual Buttons Section -->
                    <div id="individual-buttons">
                        <!-- Button 1 -->
                        <div class="button-section" data-button="1">
                            <div class="space-y-1">
                                <div class="diag-row">
                                    <span class="diag-label">Button:</span>
                                    <span class="diag-value" data-field="button-1-title">Button 1 (GPIO -)</span>
                                </div>
                                <div class="diag-row">
                                    <span class="diag-label">Short Press:</span>
                                    <span class="diag-value" data-field="button-1-short-press">-</span>
                                </div>
                                <div class="diag-row">
                                    <span class="diag-label">Long Press:</span>
                                    <span class="diag-value" data-field="button-1-long-press">-</span>
                                </div>
                                <div class="diag-row" data-field-container="button-1-short-mqtt" style="display: none;">
                                    <span class="diag-label">Short MQTT:</span>
                                    <span class="diag-value" data-field="button-1-short-mqtt">-</span>
                                </div>
                                <div class="diag-row" data-field-container="button-1-long-mqtt" style="display: none;">
                                    <span class="diag-label">Long MQTT:</span>
                                    <span class="diag-value" data-field="button-1-long-mqtt">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Button 2 -->
                        <div class="button-section" data-button="2">
                            <div class="space-y-1">
                                <div class="diag-row">
                                    <span class="diag-label">Button:</span>
                                    <span class="diag-value" data-field="button-2-title">Button 2 (GPIO -)</span>
                                </div>
                                <div class="diag-row">
                                    <span class="diag-label">Short Press:</span>
                                    <span class="diag-value" data-field="button-2-short-press">-</span>
                                </div>
                                <div class="diag-row">
                                    <span class="diag-label">Long Press:</span>
                                    <span class="diag-value" data-field="button-2-long-press">-</span>
                                </div>
                                <div class="diag-row" data-field-container="button-2-short-mqtt" style="display: none;">
                                    <span class="diag-label">Short MQTT:</span>
                                    <span class="diag-value" data-field="button-2-short-mqtt">-</span>
                                </div>
                                <div class="diag-row" data-field-container="button-2-long-mqtt" style="display: none;">
                                    <span class="diag-label">Long MQTT:</span>
                                    <span class="diag-value" data-field="button-2-long-mqtt">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Button 3 -->
                        <div class="button-section" data-button="3">
                            <div class="space-y-1">
                                <div class="diag-row">
                                    <span class="diag-label">Button:</span>
                                    <span class="diag-value" data-field="button-3-title">Button 3 (GPIO -)</span>
                                </div>
                                <div class="diag-row">
                                    <span class="diag-label">Short Press:</span>
                                    <span class="diag-value" data-field="button-3-short-press">-</span>
                                </div>
                                <div class="diag-row">
                                    <span class="diag-label">Long Press:</span>
                                    <span class="diag-value" data-field="button-3-long-press">-</span>
                                </div>
                                <div class="diag-row" data-field-container="button-3-short-mqtt" style="display: none;">
                                    <span class="diag-label">Short MQTT:</span>
                                    <span class="diag-value" data-field="button-3-short-mqtt">-</span>
                                </div>
                                <div class="diag-row" data-field-container="button-3-long-mqtt" style="display: none;">
                                    <span class="diag-label">Long MQTT:</span>
                                    <span class="diag-value" data-field="button-3-long-mqtt">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Button 4 -->
                        <div class="button-section" data-button="4">
                            <div class="space-y-1">
                                <div class="diag-row">
                                    <span class="diag-label">Button:</span>
                                    <span class="diag-value" data-field="button-4-title">Button 4 (GPIO -)</span>
                                </div>
                                <div class="diag-row">
                                    <span class="diag-label">Short Press:</span>
                                    <span class="diag-value" data-field="button-4-short-press">-</span>
                                </div>
                                <div class="diag-row">
                                    <span class="diag-label">Long Press:</span>
                                    <span class="diag-value" data-field="button-4-long-press">-</span>
                                </div>
                                <div class="diag-row" data-field-container="button-4-short-mqtt" style="display: none;">
                                    <span class="diag-label">Short MQTT:</span>
                                    <span class="diag-value" data-field="button-4-short-mqtt">-</span>
                                </div>
                                <div class="diag-row" data-field-container="button-4-long-mqtt" style="display: none;">
                                    <span class="diag-label">Long MQTT:</span>
                                    <span class="diag-value" data-field="button-4-long-mqtt">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Available Pages & Endpoints -->
            <div id="pages-endpoints-section" class="diag-section teal">
                <div class="diag-header">
                    <h4 class="diag-title teal"><span class="mr-2">üîó</span>Pages & Endpoints</h4>
                    <button data-section-name="teal" class="diag-copy-btn teal generic-copy-btn">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-4">
                    <!-- Web Pages Section -->
                    <div class="border-b border-teal-200 dark:border-teal-600 pb-3 mb-3">
                        <h5 class="text-sm font-semibold text-teal-700 dark:text-teal-300 mb-2">üìÑ Web Pages</h5>
                        <div id="web-pages" class="space-y-2">
                            <!-- Static structure for web pages - values populated by JS -->
                            <div class="diag-row loading-placeholder">
                                <span class="diag-label">Loading web pages...</span>
                                <span class="diag-value">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- API Endpoints Section -->
                    <div>
                        <h5 class="text-sm font-semibold text-teal-700 dark:text-teal-300 mb-2">üîå API Endpoints</h5>
                        <div id="api-endpoints" class="space-y-2">
                            <!-- Static structure for API endpoints - values populated by JS -->
                            <div class="diag-row loading-placeholder">
                                <span class="diag-label">Loading API endpoints...</span>
                                <span class="diag-value">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuration File -->
            <div id="config-file-section" class="diag-section red">
                <div class="diag-header">
                    <div>
                        <h4 class="diag-title red"><span class="mr-2">üìÑ</span>Config file</h4>
                        <p class="text-sm text-red-600 dark:text-red-400 mt-1">Config.json</p>
                    </div>
                    <button id="config-copy-btn" class="diag-copy-btn red">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-3">
                    <pre id="config-content" class="diag-config-display">Loading configuration...</pre>
                    <p class="diag-config-warning red">üîë Secrets are redacted</p>
                </div>
            </div>
        </div>
    </main>

    <footer class="page-footer">
        <p>&copy; 2025 Scribe Printer. Diagnostic information is refreshed automatically.</p>
    </footer>

    <script src="/js/app.min.js"></script>
    <script src="/js/diagnostics.min.js"></script>
</body>

</html>