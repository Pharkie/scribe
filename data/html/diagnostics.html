<!DOCTYPE html>
<html lang="en" class="app-root">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Scribe - Diagnostics</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/diagnostics.min.css">
</head>

<body class="page-body">
    <header class="page-header">
        <div class="header-spacer">
            <button onclick="goBack()" class="back-button">
                <span class="text-base sm:text-lg">←</span>
                <span class="text-sm sm:text-base">Back</span>
            </button>
        </div>
        <div class="header-center">
            <h1 class="page-title">📊 Diagnostics</h1>
        </div>
        <div class="header-spacer"></div>
    </header>

    <main class="page-main-wide">
        <nav class="flex flex-wrap justify-center gap-2 mb-6">
            <button onclick="showSection('device-config-section')" class="section-nav-btn section-nav-btn-purple">⚙️
                Device</button>
            <button onclick="showSection('network-section')" class="section-nav-btn section-nav-btn-blue">🌐
                Network</button>
            <button onclick="showSection('mqtt-section')" class="section-nav-btn section-nav-btn-green">📡
                MQTT</button>
            <button onclick="showSection('microcontroller-section')" class="section-nav-btn section-nav-btn-orange">🎛️
                MCU</button>
            <button onclick="showSection('unbidden-ink-section')" class="section-nav-btn section-nav-btn-yellow">📝
                Unbidden</button>
            <button onclick="showSection('logging-section')" class="section-nav-btn section-nav-btn-indigo">📋
                Logging</button>
            <button onclick="showSection('hardware-buttons-section')" class="section-nav-btn section-nav-btn-slate">🔘
                Hardware</button>
            <button onclick="showSection('pages-endpoints-section')" class="section-nav-btn section-nav-btn-slate">🔗
                Pages</button>
            <button onclick="showSection('config-file-section')" class="section-nav-btn section-nav-btn-slate">📄
                Config</button>
        </nav>

        <div id="loading" class="text-center py-8"><span class="text-2xl">⏳</span><br>Loading diagnostics...</div>
        <div id="error" class="diag-error"><span class="text-2xl">❌</span>
            <h3 class="text-lg font-semibold mb-2">Error Loading Diagnostics</h3>
            <p id="error-message" class="text-red-600 dark:text-red-400"></p>
        </div>

        <div id="diagnostics-content" class="space-y-6">
            <!-- Device Configuration -->
            <div id="device-config-section" class="diag-section purple">
                <div class="diag-header">
                    <h4 class="diag-title purple"><span class="mr-2">⚙️</span>Device Configuration</h4>
                    <button onclick="copyGenericSection('Device Configuration', this)" class="diag-copy-btn purple">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-2">
                    <div class="diag-row"><span class="diag-label">Device Owner:</span><span class="diag-value"
                            data-field="device-owner">-</span></div>
                    <div class="diag-row"><span class="diag-label">Timezone:</span><span class="diag-value"
                            data-field="timezone">-</span></div>
                    <div class="diag-row flexible"><span class="diag-label">mDNS Hostname:</span><span
                            class="diag-value flexible" data-field="mdns-hostname">-</span></div>
                    <div class="diag-row"><span class="diag-label">Max Message Chars:</span><span class="diag-value"
                            data-field="max-message-chars">-</span></div>
                </div>
            </div>

            <!-- Network -->
            <div id="network-section" class="diag-section blue">
                <div class="diag-header">
                    <h4 class="diag-title blue"><span class="mr-2">🌐</span>Network</h4>
                    <button onclick="copyGenericSection('Network', this)" class="diag-copy-btn blue">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-2">
                    <div class="diag-row"><span class="diag-label">WiFi Status:</span><span class="diag-value"
                            data-field="wifi-status">-</span></div>
                    <div class="diag-row flexible"><span class="diag-label">SSID:</span><span
                            class="diag-value flexible" data-field="wifi-ssid">-</span></div>
                    <div class="diag-row"><span class="diag-label">IP Address:</span><span class="diag-value"
                            data-field="ip-address">-</span></div>
                    <div class="diag-row"><span class="diag-label">Signal Strength:</span><span class="diag-value"
                            data-field="signal-strength">-</span></div>
                    <div class="diag-row flexible"><span class="diag-label">MAC Address:</span><span
                            class="diag-value flexible" data-field="mac-address">-</span></div>
                    <div class="diag-row"><span class="diag-label">Gateway:</span><span class="diag-value"
                            data-field="gateway">-</span></div>
                    <div class="diag-row"><span class="diag-label">DNS:</span><span class="diag-value"
                            data-field="dns">-</span></div>
                    <div class="diag-reference blue">
                        <h5 class="diag-reference-title blue"><span class="mr-2">📡</span>AP Fallback Reference</h5>
                        <div class="diag-reference-box blue">
                            <p class="text-blue-800 dark:text-blue-200 font-medium">If WiFi connection fails, device
                                creates its own network:</p>
                            <div class="space-y-1 text-blue-700 dark:text-blue-300">
                                <div><strong>Connection Timeout:</strong> <span class="font-mono"
                                        data-field="wifi-connect-timeout">15 seconds</span></div>
                                <div><strong>Network Name:</strong> <span class="font-mono">Scribe-setup</span></div>
                                <div><strong>Password:</strong> <span class="font-mono">scribe123</span></div>
                                <div><strong>IP Address:</strong> <span class="font-mono">192.168.4.1</span></div>
                                <div><strong>Setup URL:</strong> <span
                                        class="font-mono">http://192.168.4.1/settings.html</span></div>
                            </div>
                            <p class="text-blue-600 dark:text-blue-400 text-xs mt-2">💡 Connect to this network if you
                                can't reach the device on your main WiFi</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MQTT -->
            <div id="mqtt-section" class="diag-section green">
                <div class="diag-header">
                    <h4 class="diag-title green"><span class="mr-2">📡</span>MQTT</h4>
                    <button onclick="copyGenericSection('MQTT', this)" class="diag-copy-btn green">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-2">
                    <div class="diag-row"><span class="diag-label">MQTT Enabled:</span><span class="diag-value"
                            data-field="mqtt-enabled">-</span></div>
                    <div class="diag-row"><span class="diag-label">Connection Status:</span><span class="diag-value"
                            data-field="mqtt-status">-</span></div>
                    <div class="diag-row flexible"><span class="diag-label">Broker:</span><span
                            class="diag-value flexible" data-field="mqtt-broker">-</span></div>
                    <div class="diag-row"><span class="diag-label">Port:</span><span class="diag-value"
                            data-field="mqtt-port">-</span></div>
                    <div class="diag-row flexible"><span class="diag-label">Username:</span><span
                            class="diag-value flexible" data-field="mqtt-username">-</span></div>
                    <div class="diag-row flexible"><span class="diag-label">Topic:</span><span
                            class="diag-value flexible" data-field="mqtt-topic">-</span></div>
                    <div class="diag-row"><span class="diag-label">Keep Alive:</span><span class="diag-value"
                            data-field="mqtt-keep-alive">-</span></div>
                </div>
            </div>

            <!-- Microcontroller -->
            <div id="microcontroller-section" class="diag-section orange">
                <div class="diag-header">
                    <h4 class="diag-title orange"><span class="mr-2">🎛️</span>Microcontroller</h4>
                    <button onclick="copyGenericSection('Microcontroller', this)" class="diag-copy-btn orange">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-2">
                    <div class="diag-row"><span class="diag-label">CPU Frequency:</span><span class="diag-value"
                            data-field="cpu-frequency">-</span></div>
                    <div class="diag-row"><span class="diag-label">Flash Size:</span><span class="diag-value"
                            data-field="flash-size">-</span></div>
                    <div class="diag-row"><span class="diag-label">Firmware Version:</span><span class="diag-value"
                            data-field="firmware-version">-</span></div>
                    <div class="diag-row"><span class="diag-label">Uptime:</span><span class="diag-value"
                            data-field="uptime">-</span></div>
                    <div class="diag-row"><span class="diag-label">Free Heap:</span><span class="diag-value"
                            data-field="free-heap">-</span></div>
                    <div class="diag-row"><span class="diag-label">Temperature:</span><span class="diag-value"
                            data-field="temperature">-</span></div>
                    <div class="diag-memory">
                        <div class="diag-memory-item">
                            <div class="diag-memory-label"><span>Flash Usage</span><span
                                    data-field="flash-usage-text">-</span></div>
                            <div class="diag-progress-container orange">
                                <div class="diag-progress-bar orange" data-field="flash-usage-bar" style="width: 0%">
                                </div>
                            </div>
                        </div>
                        <div class="diag-memory-item">
                            <div class="diag-memory-label"><span>Heap Usage</span><span
                                    data-field="heap-usage-text">-</span></div>
                            <div class="diag-progress-container orange">
                                <div class="diag-progress-bar orange" data-field="heap-usage-bar" style="width: 0%">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Unbidden Ink -->
            <div id="unbidden-ink-section" class="diag-section yellow">
                <div class="diag-header">
                    <h4 class="diag-title yellow"><span class="mr-2">📝</span>Unbidden Ink</h4>
                    <button onclick="copyGenericSection('Unbidden Ink', this)" class="diag-copy-btn yellow">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-2">
                    <div class="diag-row"><span class="diag-label">Enabled:</span><span class="diag-value"
                            data-field="unbidden-ink-enabled">-</span></div>
                    <div class="diag-row"><span class="diag-label">Interval (minutes):</span><span class="diag-value"
                            data-field="unbidden-ink-interval">-</span></div>
                    <div class="diag-row"><span class="diag-label">Last Run:</span><span class="diag-value"
                            data-field="unbidden-ink-last-run">-</span></div>
                    <div class="diag-row"><span class="diag-label">Next Run:</span><span class="diag-value"
                            data-field="unbidden-ink-next-run">-</span></div>
                    <div class="diag-row"><span class="diag-label">Total Riddles:</span><span class="diag-value"
                            data-field="unbidden-ink-total-riddles">-</span></div>
                    <div class="diag-row"><span class="diag-label">Current Index:</span><span class="diag-value"
                            data-field="unbidden-ink-current-index">-</span></div>
                </div>
            </div>

            <!-- Logging -->
            <div id="logging-section" class="diag-section indigo">
                <div class="diag-header">
                    <h4 class="diag-title indigo"><span class="mr-2">📋</span>Logging</h4>
                    <button onclick="copyGenericSection('Logging', this)" class="diag-copy-btn indigo">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-2">
                    <div class="diag-row"><span class="diag-label">Level:</span><span class="diag-value"
                            data-field="log-level">-</span></div>
                    <div class="diag-row"><span class="diag-label">Serial Logging:</span><span class="diag-value"
                            data-field="serial-logging">-</span></div>
                    <div class="diag-row"><span class="diag-label">Web Logging:</span><span class="diag-value"
                            data-field="web-logging">-</span></div>
                    <div class="diag-row"><span class="diag-label">File Logging:</span><span class="diag-value"
                            data-field="file-logging">-</span></div>
                    <div class="diag-row"><span class="diag-label">Buffer Size:</span><span class="diag-value"
                            data-field="log-buffer-size">-</span></div>
                </div>
            </div>

            <!-- Hardware Buttons -->
            <div id="hardware-buttons-section" class="diag-section slate">
                <div class="diag-header">
                    <h4 class="diag-title slate"><span class="mr-2">🔘</span>Hardware Buttons</h4>
                    <button onclick="copyGenericSection('Hardware Buttons', this)" class="diag-copy-btn slate">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-2">
                    <div class="diag-row"><span class="diag-label">Button A Pin:</span><span class="diag-value"
                            data-field="button-a-pin">-</span></div>
                    <div class="diag-row"><span class="diag-label">Button B Pin:</span><span class="diag-value"
                            data-field="button-b-pin">-</span></div>
                    <div class="diag-row"><span class="diag-label">Button C Pin:</span><span class="diag-value"
                            data-field="button-c-pin">-</span></div>
                    <div class="diag-row"><span class="diag-label">Button A State:</span><span class="diag-value"
                            data-field="button-a-state">-</span></div>
                    <div class="diag-row"><span class="diag-label">Button B State:</span><span class="diag-value"
                            data-field="button-b-state">-</span></div>
                    <div class="diag-row"><span class="diag-label">Button C State:</span><span class="diag-value"
                            data-field="button-c-state">-</span></div>
                </div>
            </div>

            <!-- Available Pages & Endpoints -->
            <div id="pages-endpoints-section" class="diag-section slate">
                <div class="diag-header">
                    <h4 class="diag-title slate"><span class="mr-2">🔗</span>Available Pages & Endpoints</h4>
                    <button onclick="copyGenericSection('Available Pages & Endpoints', this)"
                        class="diag-copy-btn slate">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-4">
                    <div>
                        <h5 class="diag-section-heading">📄 Web Pages</h5>
                        <div id="web-pages" class="space-y-1 text-sm">-</div>
                    </div>
                    <div>
                        <h5 class="diag-section-heading">🔌 API Endpoints</h5>
                        <div id="api-endpoints" class="space-y-1 text-sm">-</div>
                    </div>
                </div>
            </div>

            <!-- Configuration File -->
            <div id="config-file-section" class="diag-section slate">
                <div class="diag-header">
                    <h4 class="diag-title slate"><span class="mr-2">📄</span>Configuration File (config.json)</h4>
                    <button onclick="copyConfigFile(this)" class="diag-copy-btn slate">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-3">
                    <pre id="config-content" class="diag-config-display">Loading configuration...</pre>
                    <p class="diag-config-warning slate">⚠️ This shows the actual config.json file. Sensitive data like
                        passwords are hidden for security.</p>
                </div>
            </div>
        </div>
    </main>

    <footer class="page-footer">
        <p>&copy; 2025 Scribe Printer. Diagnostic information is refreshed automatically.</p>
    </footer>

    <script src="../js/app.min.js"></script>
    <script src="../js/diagnostics.min.js"></script>
</body>

</html>