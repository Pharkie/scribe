<!DOCTYPE html>
<html lang="en" class="app-root">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Settings - Scribe</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/settings.min.css">
</head>

<body class="page-body">
    <main class="page-main">
        <!-- Header with title and back button -->
        <header class="page-header">
            <!-- Back button -->
            <div class="header-spacer">
                <button onclick="goBack()" class="back-button">
                    <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7">
                        </path>
                    </svg>
                    <span class="text-xs sm:text-sm font-medium">Back</span>
                </button>
            </div>

            <!-- Centered title with settings icon -->
            <div class="header-center">
                <h1 class="page-title">
                    <span class="text-4xl sm:text-5xl">‚öôÔ∏è</span>
                    <span>Settings</span>
                </h1>
            </div>

            <!-- Right spacer -->
            <div class="header-spacer"></div>
        </header>
        <!-- Loading State -->
        <div id="loading-state" class="loading-card">
            <div class="flex items-center justify-center space-x-3">
                <div class="loading-spinner"></div>
                <span class="text-gray-600 dark:text-gray-400">Loading configuration...</span>
            </div>
        </div>

        <!-- Settings Section Navigation -->
        <div id="settings-navigation" class="hidden mb-6">
            <div class="flex flex-wrap gap-2 justify-center">
                <button type="button" class="section-nav-btn section-nav-btn-blue active"
                    onclick="showSettingsSection('wifi')">üì∂ WiFi</button>
                <button type="button" class="section-nav-btn section-nav-btn-purple"
                    onclick="showSettingsSection('device')">‚öôÔ∏è Device</button>
                <button type="button" class="section-nav-btn section-nav-btn-yellow"
                    onclick="showSettingsSection('mqtt')">üì° MQTT</button>
                <button type="button" class="section-nav-btn section-nav-btn-green"
                    onclick="showSettingsSection('unbidden')">üé≤ Unbidden Ink</button>
                <button type="button" class="section-nav-btn section-nav-btn-orange"
                    onclick="showSettingsSection('buttons')">üéõÔ∏è Buttons</button>
                <button type="button" class="section-nav-btn section-nav-btn-purple"
                    onclick="showSettingsSection('leds')">üåà LEDs</button>
            </div>
        </div>

        <!-- Settings Form -->
        <form id="settings-form" class="hidden space-y-6" onsubmit="saveSettings(event)" novalidate>
            <!-- WiFi Section -->
            <div id="wifi-section" class="settings-section">
                <div class="settings-card settings-card-blue">
                    <h2 class="settings-card-header settings-card-header-blue">
                        <span class="text-3xl">üì∂</span>
                        <span>WiFi</span>
                    </h2>

                    <!-- WiFi Warning -->
                    <div class="warning-box">
                        <div class="flex items-start space-x-3">
                            <span class="text-2xl">‚ö†Ô∏è</span>
                            <div>
                                <h3 class="warning-title">WiFi Change Warning
                                </h3>
                                <p class="text-sm text-orange-700 dark:text-orange-400 mt-1">
                                    Changing WiFi settings will cause the device to restart and connect to the new
                                    network.
                                    Make sure the SSID and password are correct, or you may lose connection to the
                                    device!
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label for="wifi-ssid" class="form-label">WiFi
                                SSID:</label>
                            <input id="wifi-ssid" name="wifi_ssid" type="text" placeholder="Enter WiFi network name"
                                class="input-standard">
                        </div>
                        <div class="space-y-2">
                            <label for="wifi-password" class="form-label">WiFi Password:</label>
                            <input type="password" id="wifi-password" name="wifi.password" class="input-standard">
                        </div>
                        <div class="space-y-2">
                            <label for="wifi-timeout" class="form-label">Connection Timeout
                                (seconds):</label>
                            <input type="number" id="wifi-timeout" name="wifi.connect_timeout" min="5" max="60"
                                value="15" class="input-standard">
                            <p class="text-xs text-gray-500 dark:text-gray-400">Time to wait before falling back to AP
                                mode
                                (5-60 seconds)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Device Section -->
            <div id="device-section" class="settings-section hidden">
                <div class="settings-card settings-card-purple">
                    <h2 class="settings-card-header settings-card-header-purple">
                        <span class="text-3xl">‚öôÔ∏è</span>
                        <span>Device</span>
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label for="device-owner" class="form-label">Device Owner:</label>
                            <input type="text" id="device-owner" name="general.device_owner"
                                placeholder="Enter device owner name" class="input-standard">
                        </div>
                        <div class="space-y-2">
                            <label for="timezone" class="form-label">Timezone (IANA
                                format):</label>
                            <input type="text" id="timezone" name="device.timezone" required
                                placeholder="e.g. Europe/London, America/New_York, UTC"
                                pattern="^[A-Za-z_]+/[A-Za-z_]+$|^UTC$" class="input-standard">
                            <p class="text-sm text-gray-600 dark:text-gray-400">Use IANA timezone format (e.g.
                                Europe/London, America/New_York)</p>
                        </div>
                    </div>
                    <!-- Additional device settings -->
                    <div class="mt-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label for="max-characters" class="form-label">Max Message
                                    Characters
                                    (100-5000):</label>
                                <input type="number" id="max-characters" name="validation.maxCharacters" min="100"
                                    max="5000" required class="input-standard">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MQTT Section -->
            <div id="mqtt-section" class="settings-section hidden">
                <div class="settings-card settings-card-yellow">
                    <h2 class="settings-card-header settings-card-header-yellow">
                        <span class="text-3xl">üì°</span>
                        <span>MQTT</span>
                    </h2>
                    <div class="space-y-6">
                        <!-- Enable/Disable Toggle -->
                        <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl">
                            <div class="flex items-center space-x-3">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">Enable MQTT
                                    </h3>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Connect to MQTT broker for
                                        remote messaging</p>
                                </div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="mqtt-enabled" name="mqtt.enabled" class="sr-only peer">
                                <div
                                    class="w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-yellow-300 dark:peer-focus:ring-yellow-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white dark:after:bg-gray-200 after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-yellow-600 dark:peer-checked:bg-yellow-500">
                                </div>
                            </label>
                        </div>

                        <!-- Server gets full width -->
                        <div class="space-y-2">
                            <label for="mqtt-server" class="form-label">Server:</label>
                            <input type="text" id="mqtt-server" name="mqtt.server" required class="input-standard">
                        </div>
                        <!-- Username, Password, Port share the row (1/3 each) -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="space-y-2">
                                <label for="mqtt-username" class="form-label">Username:</label>
                                <input type="text" id="mqtt-username" name="mqtt.username" required
                                    class="input-standard">
                            </div>
                            <div class="space-y-2">
                                <label for="mqtt-password" class="form-label">Password:</label>
                                <input type="password" id="mqtt-password" name="mqtt.password" required
                                    class="input-standard">
                            </div>
                            <div class="space-y-2">
                                <label for="mqtt-port" class="form-label">Port:</label>
                                <input type="number" id="mqtt-port" name="mqtt.port" min="1" max="65535" required
                                    class="input-standard">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Unbidden Ink Section -->
            <div id="unbidden-section" class="settings-section hidden">
                <div class="settings-card settings-card-green">
                    <h2 class="settings-card-header settings-card-header-green">
                        <span class="text-3xl">üé≤</span>
                        <span>Unbidden Ink</span>
                    </h2>
                    <div class="space-y-6">
                        <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl">
                            <div class="flex items-center space-x-3">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">Enable Unbidden
                                        Ink
                                    </h3>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Automatically generate and print
                                        creative content</p>
                                </div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="unbidden-ink-enabled" name="unbiddenInk.enabled"
                                    class="sr-only peer" onchange="toggleUnbiddenInkSettings()">
                                <div
                                    class="w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 dark:peer-focus:ring-purple-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white dark:after:bg-gray-200 after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-purple-600 dark:peer-checked:bg-purple-500">
                                </div>
                            </label>
                        </div>

                        <div id="unbidden-ink-settings" class="space-y-6">
                            <!-- ChatGPT API Token -->
                            <div class="space-y-2">
                                <label for="chatgpt-api-token"
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300">ChatGPT API
                                    Token:</label>
                                <input type="password" id="chatgpt-api-token" name="apis.chatgptApiToken" required
                                    class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                <p class="text-sm text-gray-600 dark:text-gray-400">Your OpenAI API key for GPT access.
                                    <a href="https://platform.openai.com/api-keys" target="_blank"
                                        class="text-purple-600 dark:text-purple-400 hover:underline">Get your API key
                                        here</a>.
                                </p>
                            </div>

                            <!-- Time Range Slider -->
                            <div class="space-y-4">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Active Time
                                    Range:</label>
                                <div class="space-y-2">
                                    <div class="dual-range-slider">
                                        <!-- Background track container -->
                                        <div class="dual-range-track"></div>

                                        <!-- Active time track (colored section) -->
                                        <div id="time-track" class="dual-range-active"
                                            style="left: 33.33%; width: 58.33%;">
                                        </div>

                                        <!-- Dynamic click areas - will be positioned by JavaScript -->
                                        <div id="click-area-start" class="dual-range-click-area"
                                            onclick="handleSliderClick(event, 'start')"></div>
                                        <div id="click-area-end" class="dual-range-click-area"
                                            onclick="handleSliderClick(event, 'end')"></div>

                                        <!-- Start time handle - full width -->
                                        <input type="range" id="time-start" name="unbiddenInk.startHour" min="0"
                                            max="24" step="1" value="8" class="dual-range-input dual-range-start"
                                            oninput="updateTimeRange(this, 'start')" onchange="updateClickAreas()">

                                        <!-- End time handle - full width -->
                                        <input type="range" id="time-end" name="unbiddenInk.endHour" min="0" max="24"
                                            step="1" value="22" class="dual-range-input dual-range-end"
                                            oninput="updateTimeRange(this, 'end')" onchange="updateClickAreas()">
                                    </div>

                                    <!-- Time display -->
                                    <div class="flex justify-between text-sm text-gray-600 dark:text-gray-400 mt-4">
                                        <span id="time-display-start">08:00</span>
                                        <span class="text-purple-600 dark:text-purple-400 font-medium">Active
                                            Period</span>
                                        <span id="time-display-end">22:00</span>
                                    </div>

                                    <!-- Hour markers -->
                                    <div class="mx-2">
                                        <div
                                            class="flex justify-between text-xs text-gray-400 dark:text-gray-500 mt-1 relative">
                                            <!-- Always show core markers -->
                                            <span class="time-marker time-marker-0">0</span>
                                            <span class="time-marker time-marker-4">4</span>
                                            <span class="time-marker time-marker-8">8</span>
                                            <span class="time-marker time-marker-12">12</span>
                                            <span class="time-marker time-marker-16">16</span>
                                            <span class="time-marker time-marker-20">20</span>
                                            <span class="time-marker time-marker-24">24</span>

                                            <!-- Tablet+ - show every 2 hours -->
                                            <span class="time-marker time-marker-2 hidden sm:inline">2</span>
                                            <span class="time-marker time-marker-6 hidden sm:inline">6</span>
                                            <span class="time-marker time-marker-10 hidden sm:inline">10</span>
                                            <span class="time-marker time-marker-14 hidden sm:inline">14</span>
                                            <span class="time-marker time-marker-18 hidden sm:inline">18</span>
                                            <span class="time-marker time-marker-22 hidden sm:inline">22</span>

                                            <!-- Desktop only - show remaining hours -->
                                            <span class="time-marker time-marker-1 hidden lg:inline">1</span>
                                            <span class="time-marker time-marker-3 hidden lg:inline">3</span>
                                            <span class="time-marker time-marker-5 hidden lg:inline">5</span>
                                            <span class="time-marker time-marker-7 hidden lg:inline">7</span>
                                            <span class="time-marker time-marker-9 hidden lg:inline">9</span>
                                            <span class="time-marker time-marker-11 hidden lg:inline">11</span>
                                            <span class="time-marker time-marker-13 hidden lg:inline">13</span>
                                            <span class="time-marker time-marker-15 hidden lg:inline">15</span>
                                            <span class="time-marker time-marker-17 hidden lg:inline">17</span>
                                            <span class="time-marker time-marker-19 hidden lg:inline">19</span>
                                            <span class="time-marker time-marker-21 hidden lg:inline">21</span>
                                            <span class="time-marker time-marker-23 hidden lg:inline">23</span>
                                            <span class="time-marker time-marker-24">24</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Frequency Slider -->
                            <div class="space-y-4">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Generation
                                    Frequency:</label>
                                <div class="space-y-4">
                                    <!-- Frequency slider with non-linear scale -->
                                    <div class="space-y-2">
                                        <div class="single-range-slider">
                                            <!-- Background track -->
                                            <div class="single-range-track"></div>

                                            <!-- Frequency slider -->
                                            <input type="range" id="frequency-slider" min="0" max="7" step="1" value="3"
                                                class="single-range-input"
                                                oninput="updateFrequencyFromSlider(this.value)">
                                        </div>

                                        <!-- Frequency markers -->
                                        <div class="flex justify-between text-xs text-gray-400 dark:text-gray-500 mt-1">
                                            <span>15min</span>
                                            <span>30min</span>
                                            <span>45min</span>
                                            <span>1hr</span>
                                            <span>2hr</span>
                                            <span>4hr</span>
                                            <span>6hr</span>
                                            <span>8hr</span>
                                        </div>
                                    </div>

                                    <!-- Hidden input for the actual value -->
                                    <input type="hidden" id="frequency-minutes" name="unbiddenInk.frequencyMinutes"
                                        value="60">

                                    <!-- Current selection display -->
                                    <div class="text-center">
                                        <span
                                            class="inline-flex items-center px-4 py-2 bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300 rounded-lg text-sm font-medium">
                                            <span class="text-lg mr-2">‚è±Ô∏è</span>
                                            <span id="frequency-display">Around once per hour from 8 am to 10 pm each
                                                day</span>
                                        </span>
                                        <div id="next-scheduled" class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                                            <!-- Next scheduled time will be populated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Prompt Presets and Custom Input -->
                            <div class="space-y-4">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Content
                                    Generation
                                    Prompt:</label>

                                <!-- Prompt preset buttons -->
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                    <button type="button"
                                        class="prompt-preset text-left p-4 rounded-xl border border-gray-300 dark:border-gray-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 focus:outline-none focus:ring-2 focus:ring-purple-400 transition-all"
                                        onclick="setPrompt('Generate a short, inspiring quote about creativity, technology, or daily life. Keep it under 200 characters.')">
                                        <div class="flex items-start space-x-3">
                                            <span class="text-2xl">üí≠</span>
                                            <div>
                                                <h4 class="font-medium text-gray-800 dark:text-gray-100">Inspirational
                                                    Quotes</h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Daily wisdom and
                                                    motivation</p>
                                            </div>
                                        </div>
                                    </button>

                                    <button type="button"
                                        class="prompt-preset text-left p-4 rounded-xl border border-gray-300 dark:border-gray-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 focus:outline-none focus:ring-2 focus:ring-purple-400 transition-all"
                                        onclick="setPrompt('Generate a fun fact under 200 characters about BBC Doctor Who - the characters, episodes, behind-the-scenes trivia, or the show\'s history that is esoteric and only 5% of fans might know.')">
                                        <div class="flex items-start space-x-3">
                                            <span class="text-2xl">üï∞Ô∏è</span>
                                            <div>
                                                <h4 class="font-medium text-gray-800 dark:text-gray-100">Doctor Who
                                                    Facts
                                                </h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Timey-wimey trivia
                                                    and
                                                    lore</p>
                                            </div>
                                        </div>
                                    </button>

                                    <button type="button"
                                        class="prompt-preset text-left p-4 rounded-xl border border-gray-300 dark:border-gray-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 focus:outline-none focus:ring-2 focus:ring-purple-400 transition-all"
                                        onclick="setPrompt('Write a short, humorous observation about everyday life or a witty one-liner. Keep it light and under 200 characters.')">
                                        <div class="flex items-start space-x-3">
                                            <span class="text-2xl">üòÑ</span>
                                            <div>
                                                <h4 class="font-medium text-gray-800 dark:text-gray-100">Humor & Wit
                                                </h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Light-hearted
                                                    observations</p>
                                            </div>
                                        </div>
                                    </button>

                                    <button type="button"
                                        class="prompt-preset text-left p-4 rounded-xl border border-gray-300 dark:border-gray-600 hover:bg-purple-50 dark:hover:bg-purple-900/20 focus:outline-none focus:ring-2 focus:ring-purple-400 transition-all"
                                        onclick="setPrompt('Generate a short creative writing prompt, mini-story, or poetic thought. Be imaginative and keep under 250 characters.')">
                                        <div class="flex items-start space-x-3">
                                            <span class="text-2xl">‚ú®</span>
                                            <div>
                                                <h4 class="font-medium text-gray-800 dark:text-gray-100">Creative Sparks
                                                </h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Imaginative and
                                                    artistic
                                                    content</p>
                                            </div>
                                        </div>
                                    </button>
                                </div>

                                <!-- Custom prompt textarea -->
                                <div class="space-y-2">
                                    <label for="unbidden-ink-prompt"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">Custom
                                        Prompt:</label>
                                    <textarea id="unbidden-ink-prompt" name="unbiddenInk.prompt" rows="4"
                                        placeholder="Enter your custom prompt here, or click one of the preset buttons above..."
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent resize-none text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700"></textarea>
                                </div>

                                <!-- Test Unbidden Ink -->
                                <div class="pt-4 text-right">
                                    <button type="button" onclick="testUnbiddenInk()"
                                        class="text-sm text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-300 hover:underline font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-green-400 rounded">
                                        Bid Unbidden Ink To Scribe Now
                                    </button>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>
            </div>

            <!-- Buttons Section -->
            <div id="buttons-section" class="settings-section hidden">
                <div
                    class="bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-700 shadow-2xl rounded-3xl p-8">
                    <h2
                        class="text-2xl font-bold text-orange-800 dark:text-orange-100 mb-6 flex items-center space-x-2">
                        <span class="text-3xl">üéõÔ∏è</span>
                        <span>Buttons</span>
                    </h2>
                    <div class="space-y-6">

                        <!-- Button 1 -->
                        <div class="border border-gray-200 dark:border-gray-600 rounded-xl p-4">
                            <h3 class="text-lg font-medium text-gray-800 dark:text-gray-100 mb-4">Button 1 (GPIO 5)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="space-y-2">
                                    <label for="button1-short"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">Short Press
                                        Action:</label>
                                    <select id="button1-short" name="buttons.button1.shortAction"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                        <option value="">None</option>
                                        <option value="/api/joke">Joke</option>
                                        <option value="/api/riddle">Riddle</option>
                                        <option value="/api/quote">Quote</option>
                                        <option value="/api/quiz">Quiz</option>
                                        <option value="/api/news">News</option>
                                        <option value="/api/print-test">Print Test</option>
                                        <option value="/api/unbidden-ink">Unbidden Ink</option>
                                    </select>
                                    <label for="button1-short-mqtt"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">MQTT topic
                                        (leave
                                        blank to scribe local direct):</label>
                                    <input type="text" id="button1-short-mqtt" name="buttons.button1.shortMqttTopic"
                                        placeholder="/scribe/Riccy/print/"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                </div>
                                <div class="space-y-2">
                                    <label for="button1-long"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">Long Press
                                        Action:</label>
                                    <select id="button1-long" name="buttons.button1.longAction"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                        <option value="">None</option>
                                        <option value="/api/joke">Joke</option>
                                        <option value="/api/riddle">Riddle</option>
                                        <option value="/api/quote">Quote</option>
                                        <option value="/api/quiz">Quiz</option>
                                        <option value="/api/news">News</option>
                                        <option value="/api/print-test">Print Test</option>
                                        <option value="/api/unbidden-ink">Unbidden Ink</option>
                                    </select>
                                    <label for="button1-long-mqtt"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">MQTT topic
                                        (leave
                                        blank to scribe local direct):</label>
                                    <input type="text" id="button1-long-mqtt" name="buttons.button1.longMqttTopic"
                                        placeholder="/scribe/Riccy/print/"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                </div>
                            </div>
                        </div>

                        <!-- Button 2 -->
                        <div class="border border-gray-200 dark:border-gray-600 rounded-xl p-4">
                            <h3 class="text-lg font-medium text-gray-800 dark:text-gray-100 mb-4">Button 2 (GPIO 6)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="space-y-2">
                                    <label for="button2-short"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">Short Press
                                        Action:</label>
                                    <select id="button2-short" name="buttons.button2.shortAction"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                        <option value="">None</option>
                                        <option value="/api/joke">Joke</option>
                                        <option value="/api/riddle">Riddle</option>
                                        <option value="/api/quote">Quote</option>
                                        <option value="/api/quiz">Quiz</option>
                                        <option value="/api/news">News</option>
                                        <option value="/api/print-test">Print Test</option>
                                        <option value="/api/unbidden-ink">Unbidden Ink</option>
                                    </select>
                                    <label for="button2-short-mqtt"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">MQTT topic
                                        (leave
                                        blank to scribe local direct):</label>
                                    <input type="text" id="button2-short-mqtt" name="buttons.button2.shortMqttTopic"
                                        placeholder="/scribe/Riccy/print/"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                </div>
                                <div class="space-y-2">
                                    <label for="button2-long"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">Long Press
                                        Action:</label>
                                    <select id="button2-long" name="buttons.button2.longAction"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                        <option value="">None</option>
                                        <option value="/api/joke">Joke</option>
                                        <option value="/api/riddle">Riddle</option>
                                        <option value="/api/quote">Quote</option>
                                        <option value="/api/quiz">Quiz</option>
                                        <option value="/api/news">News</option>
                                        <option value="/api/print-test">Print Test</option>
                                        <option value="/api/unbidden-ink">Unbidden Ink</option>
                                    </select>
                                    <label for="button2-long-mqtt"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">MQTT topic
                                        (leave
                                        blank to scribe local direct):</label>
                                    <input type="text" id="button2-long-mqtt" name="buttons.button2.longMqttTopic"
                                        placeholder="/scribe/Riccy/print/"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                </div>
                            </div>
                        </div>

                        <!-- Button 3 -->
                        <div class="border border-gray-200 dark:border-gray-600 rounded-xl p-4">
                            <h3 class="text-lg font-medium text-gray-800 dark:text-gray-100 mb-4">Button 3 (GPIO 7)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="space-y-2">
                                    <label for="button3-short"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">Short Press
                                        Action:</label>
                                    <select id="button3-short" name="buttons.button3.shortAction"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                        <option value="">None</option>
                                        <option value="/api/joke">Joke</option>
                                        <option value="/api/riddle">Riddle</option>
                                        <option value="/api/quote">Quote</option>
                                        <option value="/api/quiz">Quiz</option>
                                        <option value="/api/news">News</option>
                                        <option value="/api/print-test">Print Test</option>
                                        <option value="/api/unbidden-ink">Unbidden Ink</option>
                                    </select>
                                    <label for="button3-short-mqtt"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">MQTT topic
                                        (leave
                                        blank to scribe local direct):</label>
                                    <input type="text" id="button3-short-mqtt" name="buttons.button3.shortMqttTopic"
                                        placeholder="/scribe/Riccy/print/"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                </div>
                                <div class="space-y-2">
                                    <label for="button3-long"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">Long Press
                                        Action:</label>
                                    <select id="button3-long" name="buttons.button3.longAction"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                        <option value="">None</option>
                                        <option value="/api/joke">Joke</option>
                                        <option value="/api/riddle">Riddle</option>
                                        <option value="/api/quote">Quote</option>
                                        <option value="/api/quiz">Quiz</option>
                                        <option value="/api/news">News</option>
                                        <option value="/api/print-test">Print Test</option>
                                        <option value="/api/unbidden-ink">Unbidden Ink</option>
                                    </select>
                                    <label for="button3-long-mqtt"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">MQTT topic
                                        (leave
                                        blank to scribe local direct):</label>
                                    <input type="text" id="button3-long-mqtt" name="buttons.button3.longMqttTopic"
                                        placeholder="/scribe/Riccy/print/"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                </div>
                            </div>
                        </div>

                        <!-- Button 4 -->
                        <div class="border border-gray-200 dark:border-gray-600 rounded-xl p-4">
                            <h3 class="text-lg font-medium text-gray-800 dark:text-gray-100 mb-4">Button 4 (GPIO 8)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="space-y-2">
                                    <label for="button4-short"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">Short Press
                                        Action:</label>
                                    <select id="button4-short" name="buttons.button4.shortAction"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                        <option value="">None</option>
                                        <option value="/api/joke">Joke</option>
                                        <option value="/api/riddle">Riddle</option>
                                        <option value="/api/quote">Quote</option>
                                        <option value="/api/quiz">Quiz</option>
                                        <option value="/api/news">News</option>
                                        <option value="/api/print-test">Print Test</option>
                                        <option value="/api/unbidden-ink">Unbidden Ink</option>
                                    </select>
                                    <label for="button4-short-mqtt"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">MQTT topic
                                        (leave
                                        blank to scribe local direct):</label>
                                    <input type="text" id="button4-short-mqtt" name="buttons.button4.shortMqttTopic"
                                        placeholder="/scribe/Riccy/print/"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                </div>
                                <div class="space-y-2">
                                    <label for="button4-long"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">Long Press
                                        Action:</label>
                                    <select id="button4-long" name="buttons.button4.longAction"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                        <option value="">None</option>
                                        <option value="/api/joke">Joke</option>
                                        <option value="/api/riddle">Riddle</option>
                                        <option value="/api/quote">Quote</option>
                                        <option value="/api/quiz">Quiz</option>
                                        <option value="/api/news">News</option>
                                        <option value="/api/print-test">Print Test</option>
                                        <option value="/api/unbidden-ink">Unbidden Ink</option>
                                    </select>
                                    <label for="button4-long-mqtt"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">MQTT topic
                                        (leave
                                        blank to scribe local direct):</label>
                                    <input type="text" id="button4-long-mqtt" name="buttons.button4.longMqttTopic"
                                        placeholder="/scribe/Riccy/print/"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LEDs Section -->
            <div id="leds-section" class="settings-section hidden">
                <div
                    class="bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-700 shadow-2xl rounded-3xl p-8">
                    <h2
                        class="text-2xl font-bold text-purple-800 dark:text-purple-100 mb-6 flex items-center space-x-2">
                        <span class="text-3xl">üåà</span>
                        <span>LEDs</span>
                    </h2>

                    <!-- LED Configuration Notice -->
                    <div class="warning-box mb-6">
                        <div class="flex items-center space-x-2">
                            <span class="text-2xl">‚ö°</span>
                            <div class="flex-1">
                                <p class="font-semibold text-amber-800 dark:text-amber-200">LED Configuration</p>
                                <p class="text-sm text-amber-700 dark:text-amber-300">
                                    Changes to LED settings will reinitialize the LED strip. Make sure your LED strip is
                                    properly connected before saving.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <!-- Hardware Configuration -->
                        <div class="border border-gray-200 dark:border-gray-600 rounded-xl p-4">
                            <h3 class="text-lg font-medium text-gray-800 dark:text-gray-100 mb-4">Hardware Configuration
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="space-y-2">
                                    <label for="led-pin"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">GPIO
                                        Pin</label>
                                    <select id="led-pin" name="leds.pin"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                        <option value="0">GPIO0 (boot mode, avoid)</option>
                                        <option value="1">GPIO1 (usable)</option>
                                        <option value="2">GPIO2 (usable)</option>
                                        <option value="3">GPIO3 (usable)</option>
                                        <option value="4" selected>GPIO4 (usable)</option>
                                        <option value="5">GPIO5 (usable)</option>
                                        <option value="6">GPIO6 (usable)</option>
                                        <option value="7">GPIO7 (usable)</option>
                                        <option value="8">GPIO8 (flash, avoid)</option>
                                        <option value="9">GPIO9 (flash, avoid)</option>
                                        <option value="10">GPIO10 (flash, avoid)</option>
                                        <option value="11">GPIO11 (not broken out)</option>
                                        <option value="12">GPIO12 (not broken out)</option>
                                        <option value="13">GPIO13 (usable, often SCL)</option>
                                        <option value="14">GPIO14 (usable, often SDA)</option>
                                        <option value="15">GPIO15 (not broken out)</option>
                                        <option value="16">GPIO16 (not broken out)</option>
                                        <option value="17">GPIO17 (not broken out)</option>
                                        <option value="18">GPIO18 (USB/JTAG, avoid unless advanced)</option>
                                        <option value="19">GPIO19 (USB/JTAG, avoid unless advanced)</option>
                                        <option value="20">GPIO20 (usable, often RX)</option>
                                        <option value="21">GPIO21 (usable, often TX)</option>
                                    </select>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">
                                        ‚ö†Ô∏è Not all boards expose every pin. On boards like the ESP32-C3 SuperMini,
                                        usually ~15‚Äì16 of these are available. Pins marked avoid are connected to flash
                                        or USB and should not be reassigned.
                                    </p>
                                </div>
                                <div class="space-y-2">
                                    <label for="led-count"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">LED
                                        Count</label>
                                    <input type="number" id="led-count" name="leds.count" min="1" max="300" step="1"
                                        placeholder="30"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                </div>
                            </div>
                        </div>

                        <!-- Performance Configuration -->
                        <div class="border border-gray-200 dark:border-gray-600 rounded-xl p-4">
                            <h3 class="text-lg font-medium text-gray-800 dark:text-gray-100 mb-4">Performance Settings
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="space-y-2">
                                    <label for="led-brightness"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">Brightness
                                        (0-255)</label>
                                    <input type="number" id="led-brightness" name="leds.brightness" min="0" max="255"
                                        step="1" placeholder="64"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                    <p class="text-xs text-gray-500 dark:text-gray-400">
                                        ‚ö° High brightness (&gt;128) significantly increases current draw. Consider power
                                        supply limits and heat generation.
                                    </p>
                                </div>
                                <div class="space-y-2">
                                    <label for="led-refresh-rate"
                                        class="block text-sm font-medium text-gray-700 dark:text-gray-300">Refresh Rate
                                        (Hz)</label>
                                    <input type="number" id="led-refresh-rate" name="leds.refreshRate" min="10"
                                        max="120" step="1" placeholder="60"
                                        class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                    <p class="text-xs text-gray-500 dark:text-gray-400">
                                        üß† Higher refresh rates (&gt;60Hz) use more memory and CPU. 30-60Hz is optimal
                                        for most effects.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Per-Effect Autonomous Configuration (temporarily restored) -->
                        <div class="border border-gray-200 dark:border-gray-600 rounded-xl p-4">
                            <h3 class="text-lg font-medium text-gray-800 dark:text-gray-100 mb-4">Per-Effect Autonomous
                                Settings</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">Each effect has its own independent
                                configuration. Changes only affect the selected effect.</p>

                            <!-- Chase Single Configuration -->
                            <details class="group mb-4 border border-gray-200 dark:border-gray-600 rounded-lg">
                                <summary
                                    class="cursor-pointer p-3 bg-gray-50 dark:bg-gray-700 rounded-lg font-medium text-gray-800 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                    Chase Single Effect Settings
                                </summary>
                                <div class="p-4 space-y-4 border-t border-gray-200 dark:border-gray-600">
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        <div class="space-y-2">
                                            <label for="chase-single-speed"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Speed
                                                (1-100, higher=slower)</label>
                                            <input type="number" id="chase-single-speed" min="1" max="100" step="1"
                                                placeholder="5"
                                                class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="chase-single-trail-length"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Trail
                                                Length</label>
                                            <input type="number" id="chase-single-trail-length" min="1" max="50"
                                                step="1" placeholder="15"
                                                class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="chase-single-trail-fade"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Trail
                                                Fade (0-255)</label>
                                            <input type="number" id="chase-single-trail-fade" min="0" max="255" step="1"
                                                placeholder="15"
                                                class="w-full p-3 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-800 dark:text-gray-100 bg-white dark:bg-gray-700">
                                        </div>
                                    </div>
                                    <div class="space-y-2">
                                        <label for="chase-single-color"
                                            class="block text-sm font-medium text-gray-700 dark:text-gray-300">Color</label>
                                        <input type="color" id="chase-single-color" value="#0062ff"
                                            class="w-20 h-12 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400">
                                    </div>
                                </div>
                            </details>

                            <!-- Chase Multi Configuration -->
                            <details class="group mb-4 border border-gray-200 dark:border-gray-600 rounded-lg">
                                <summary
                                    class="cursor-pointer p-3 bg-gray-50 dark:bg-gray-700 rounded-lg font-medium text-gray-800 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                    Chase Multi Effect Settings
                                </summary>
                                <div class="p-4 space-y-4 border-t border-gray-200 dark:border-gray-600">
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        <div class="space-y-2">
                                            <label for="chase-multi-speed"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Speed
                                                (1-100)</label>
                                            <input type="number" id="chase-multi-speed" min="1" max="100" step="1"
                                                value="2" class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="chase-multi-trail-length"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Trail
                                                Length</label>
                                            <input type="number" id="chase-multi-trail-length" min="1" max="50" step="1"
                                                value="20" class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="chase-multi-trail-fade"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Trail
                                                Fade</label>
                                            <input type="number" id="chase-multi-trail-fade" min="0" max="255" step="1"
                                                value="20" class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="chase-multi-color-spacing"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Color
                                                Spacing</label>
                                            <input type="number" id="chase-multi-color-spacing" min="1" max="30"
                                                step="1" value="12" class="input-standard">
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div class="space-y-2">
                                            <label for="chase-multi-color1"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Color
                                                1</label>
                                            <input type="color" id="chase-multi-color1" value="#ff9900"
                                                class="w-20 h-12 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="chase-multi-color2"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Color
                                                2</label>
                                            <input type="color" id="chase-multi-color2" value="#008f00"
                                                class="w-20 h-12 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="chase-multi-color3"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Color
                                                3</label>
                                            <input type="color" id="chase-multi-color3" value="#78cffe"
                                                class="w-20 h-12 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400">
                                        </div>
                                    </div>
                                </div>
                            </details>

                            <!-- Matrix Configuration -->
                            <details class="group mb-4 border border-gray-200 dark:border-gray-600 rounded-lg">
                                <summary
                                    class="cursor-pointer p-3 bg-gray-50 dark:bg-gray-700 rounded-lg font-medium text-gray-800 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                    Matrix Effect Settings
                                </summary>
                                <div class="p-4 space-y-4 border-t border-gray-200 dark:border-gray-600">
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        <div class="space-y-2">
                                            <label for="matrix-speed"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Speed
                                                (1-100)</label>
                                            <input type="number" id="matrix-speed" min="1" max="100" step="1" value="3"
                                                class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="matrix-drops"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Number
                                                of Drops</label>
                                            <input type="number" id="matrix-drops" min="1" max="20" step="1" value="5"
                                                class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="matrix-background-fade"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Background
                                                Fade</label>
                                            <input type="number" id="matrix-background-fade" min="1" max="255" step="1"
                                                value="64" class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="matrix-trail-fade"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Trail
                                                Fade</label>
                                            <input type="number" id="matrix-trail-fade" min="1" max="255" step="1"
                                                value="32" class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="matrix-brightness-fade"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Brightness
                                                Fade</label>
                                            <input type="number" id="matrix-brightness-fade" min="1" max="100" step="1"
                                                value="40" class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="matrix-color"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Color</label>
                                            <input type="color" id="matrix-color" value="#009100"
                                                class="w-20 h-12 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400">
                                        </div>
                                    </div>
                                </div>
                            </details>

                            <!-- Twinkle Configuration -->
                            <details class="group mb-4 border border-gray-200 dark:border-gray-600 rounded-lg">
                                <summary
                                    class="cursor-pointer p-3 bg-gray-50 dark:bg-gray-700 rounded-lg font-medium text-gray-800 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                    Twinkle Stars Effect Settings
                                </summary>
                                <div class="p-4 space-y-4 border-t border-gray-200 dark:border-gray-600">
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        <div class="space-y-2">
                                            <label for="twinkle-density"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Density
                                                (1-30)</label>
                                            <input type="number" id="twinkle-density" min="1" max="30" step="1"
                                                value="8" class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="twinkle-fade-speed"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Fade
                                                Speed</label>
                                            <input type="number" id="twinkle-fade-speed" min="1" max="50" step="1"
                                                value="5" class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="twinkle-min-brightness"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Min
                                                Brightness</label>
                                            <input type="number" id="twinkle-min-brightness" min="0" max="255" step="1"
                                                value="50" class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="twinkle-max-brightness"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Max
                                                Brightness</label>
                                            <input type="number" id="twinkle-max-brightness" min="0" max="255" step="1"
                                                value="255" class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="twinkle-color"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Color</label>
                                            <input type="color" id="twinkle-color" value="#ffffff"
                                                class="w-20 h-12 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400">
                                        </div>
                                    </div>
                                </div>
                            </details>

                            <!-- Pulse Configuration -->
                            <details class="group mb-4 border border-gray-200 dark:border-gray-600 rounded-lg">
                                <summary
                                    class="cursor-pointer p-3 bg-gray-50 dark:bg-gray-700 rounded-lg font-medium text-gray-800 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                    Pulse Wave Effect Settings
                                </summary>
                                <div class="p-4 space-y-4 border-t border-gray-200 dark:border-gray-600">
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        <div class="space-y-2">
                                            <label for="pulse-speed"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Speed
                                                (1-100)</label>
                                            <input type="number" id="pulse-speed" min="1" max="100" step="1" value="4"
                                                class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="pulse-min-brightness"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Min
                                                Brightness</label>
                                            <input type="number" id="pulse-min-brightness" min="0" max="255" step="1"
                                                value="0" class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="pulse-max-brightness"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Max
                                                Brightness</label>
                                            <input type="number" id="pulse-max-brightness" min="0" max="255" step="1"
                                                value="255" class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="pulse-wave-frequency"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Wave
                                                Frequency</label>
                                            <input type="number" id="pulse-wave-frequency" value="0.05"
                                                class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="pulse-color"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Color</label>
                                            <input type="color" id="pulse-color" value="#ff00f2"
                                                class="w-20 h-12 rounded-xl border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400">
                                        </div>
                                    </div>
                                </div>
                            </details>

                            <!-- Rainbow Configuration -->
                            <details class="group mb-4 border border-gray-200 dark:border-gray-600 rounded-lg">
                                <summary
                                    class="cursor-pointer p-3 bg-gray-50 dark:bg-gray-700 rounded-lg font-medium text-gray-800 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                    Rainbow Wave Effect Settings
                                </summary>
                                <div class="p-4 space-y-4 border-t border-gray-200 dark:border-gray-600">
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        <div class="space-y-2">
                                            <label for="rainbow-speed"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Speed
                                                (0.1-10.0)</label>
                                            <input type="number" id="rainbow-speed" min="0.1" max="10.0" step="0.1"
                                                value="2.0" class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="rainbow-saturation"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Saturation</label>
                                            <input type="number" id="rainbow-saturation" min="0" max="255" step="1"
                                                value="255" class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="rainbow-brightness"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Brightness</label>
                                            <input type="number" id="rainbow-brightness" min="0" max="255" step="1"
                                                value="255" class="input-standard">
                                        </div>
                                        <div class="space-y-2">
                                            <label for="rainbow-hue-step"
                                                class="block text-sm font-medium text-gray-700 dark:text-gray-300">Hue
                                                Step</label>
                                            <input type="number" id="rainbow-hue-step" min="0.1" max="10.0" step="0.1"
                                                value="2.5" class="input-standard">
                                        </div>
                                    </div>
                                </div>
                            </details>
                        </div> <!-- LED Effect Triggers -->
                        <div class="border border-gray-200 dark:border-gray-600 rounded-xl p-4">
                            <h3 class="text-lg font-medium text-gray-800 dark:text-gray-100 mb-4">Test LED Effects</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                                Shows for 10 seconds.
                            </p>
                            <!-- LED Effect Buttons with improved responsive layout -->
                            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-4 gap-3">
                                <button type="button" onclick="triggerLedEffect('chase_single')"
                                    class="led-effect-btn bg-blue-100 hover:bg-blue-200 dark:bg-blue-900/30 dark:hover:bg-blue-800/40 text-blue-800 dark:text-blue-300 border-blue-300 dark:border-blue-600">
                                    üèÉ Chase Single
                                </button>
                                <button type="button" onclick="triggerLedEffect('rainbow')"
                                    class="led-effect-btn bg-red-100 hover:bg-red-200 dark:bg-red-900/30 dark:hover:bg-red-800/40 text-red-800 dark:text-red-300 border-red-300 dark:border-red-600">
                                    üåà Rainbow Wave
                                </button>
                                <button type="button" onclick="triggerLedEffect('twinkle')"
                                    class="led-effect-btn bg-yellow-100 hover:bg-yellow-200 dark:bg-yellow-900/30 dark:hover:bg-yellow-800/40 text-yellow-800 dark:text-yellow-300 border-yellow-300 dark:border-yellow-600">
                                    ‚≠ê Twinkle Stars
                                </button>
                                <button type="button" onclick="triggerLedEffect('chase_multi')"
                                    class="led-effect-btn bg-green-100 hover:bg-green-200 dark:bg-green-900/30 dark:hover:bg-green-800/40 text-green-800 dark:text-green-300 border-green-300 dark:border-green-600">
                                    üéØ Chase Multi
                                </button>
                                <button type="button" onclick="triggerLedEffect('pulse')"
                                    class="led-effect-btn bg-purple-100 hover:bg-purple-200 dark:bg-purple-900/30 dark:hover:bg-purple-800/40 text-purple-800 dark:text-purple-300 border-purple-300 dark:border-purple-600">
                                    üíì Pulse Wave
                                </button>
                                <button type="button" onclick="triggerLedEffect('matrix')"
                                    class="led-effect-btn bg-green-100 hover:bg-green-200 dark:bg-green-900/30 dark:hover:bg-green-800/40 text-green-800 dark:text-green-300 border-green-300 dark:border-green-600">
                                    üîã Matrix
                                </button>
                                <!-- Turn Off button integrated into the grid -->
                                <button type="button" onclick="turnOffLeds()"
                                    class="led-effect-btn bg-gray-100 hover:bg-gray-200 dark:bg-gray-800/30 dark:hover:bg-gray-700/40 text-gray-800 dark:text-gray-300 border-gray-300 dark:border-gray-600 sm:col-span-1 lg:col-span-2 xl:col-span-2">
                                    ‚ö´ LEDs Off
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex space-x-4">
                <button type="button" onclick="goBack()" id="close-button" class="form-button-secondary">
                    Close
                </button>
                <button type="submit" id="save-button" class="form-button-primary">
                    Save Settings
                </button>
            </div>
        </form>
    </main>

    <!-- Success/Error Messages -->
    <div id="message-container" class="fixed top-4 right-4 z-50"></div>

    <!-- Load main app bundle (shared functionality) -->
    <script src="/js/app.min.js"></script>
    <!-- Load consolidated settings JavaScript -->
    <script src="/js/settings.min.js"></script>
</body>

</html>