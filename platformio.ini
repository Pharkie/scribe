; Main application environment - builds and deploys the Scribe printer firmware
[env:main]
platform = espressif32
board = esp32-c3-devkitc-02
framework = arduino
lib_deps = 
    arduino-libraries/NTPClient@^3.2.1
    ropg/ezTime@^0.8.3
    bblanchon/ArduinoJson@^6.21.3
    knolleary/PubSubClient@^2.8
    thijse/ArduinoLog@^1.1.1
    me-no-dev/AsyncTCP@^1.1.1
    https://github.com/me-no-dev/ESPAsyncWebServer.git
    fastled/FastLED@^3.7.8
monitor_speed = 115200
monitor_filters = 
    esp32_exception_decoder
    colorize
monitor_rts = 0
monitor_dtr = 0
upload_speed = 460800
build_flags = 
    -std=gnu++17
    -DCORE_DEBUG_LEVEL=1
    -DBOARD_HAS_PSRAM=0
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DFIRMWARE_VERSION=\"1.0.0\"
    -DASYNC_TCP_SSL_ENABLED=0
    -DCONFIG_ASYNC_TCP_MAX_ACK_TIME=3000
    -DCONFIG_ASYNC_TCP_PRIORITY=10
    -DCONFIG_ASYNC_TCP_QUEUE_SIZE=32
    -DASYNCWEBSERVER_REGEX=1
    -DENABLE_LEDS=1
    -DDISABLE_OTA=1
    -Os
    -ffunction-sections
    -fdata-sections
    -DARDUINOJSON_USE_LONG_LONG=0
build_unflags = 
    -O2
    -std=gnu++11
    -std=c++11
    -std=c++17
upload_port = /dev/cu.usbmodem1201
monitor_port = /dev/cu.usbmodem1201
board_build.filesystem = littlefs
board_build.partitions = partitions_no_ota.csv

; Custom task to upload filesystem and firmware  
extra_scripts = 
    pre:scripts/generate_config_example.py
    scripts/build_upload_monitor.py

; Test environment - runs Unity test suite, excludes main.cpp to avoid conflicts
[env:test]
platform = espressif32
board = esp32-c3-devkitc-02
framework = arduino
lib_deps = 
    arduino-libraries/NTPClient@^3.2.1
    ropg/ezTime@^0.8.3
    bblanchon/ArduinoJson@^6.21.3
    knolleary/PubSubClient@^2.8
    thijse/ArduinoLog@^1.1.1
    me-no-dev/AsyncTCP@^1.1.1
    https://github.com/me-no-dev/ESPAsyncWebServer.git
    fastled/FastLED@^3.7.8
monitor_speed = 115200
monitor_filters = 
    esp32_exception_decoder
    colorize
monitor_rts = 0
monitor_dtr = 0
upload_speed = 115200
build_flags = 
    -std=gnu++17
    -DCORE_DEBUG_LEVEL=3
    -DBOARD_HAS_PSRAM=0
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DFIRMWARE_VERSION=\"1.0.0\"
    -DASYNC_TCP_SSL_ENABLED=0
    -DCONFIG_ASYNC_TCP_MAX_ACK_TIME=3000
    -DCONFIG_ASYNC_TCP_PRIORITY=10
    -DCONFIG_ASYNC_TCP_QUEUE_SIZE=32
    -DASYNCWEBSERVER_REGEX=1
    -DARDUINO_JSON_USE_DOUBLE=0
    -DARDUINO_JSON_USE_LONG_LONG=0
    -DENABLE_LEDS=1
    -Os
    -ffunction-sections
    -fdata-sections
    -Wl,--gc-sections
build_unflags = 
    -O2
    -std=gnu++11
    -std=c++11
    -std=c++17
upload_port = /dev/cu.usbmodem1201
monitor_port = /dev/cu.usbmodem1201
board_build.filesystem = littlefs
test_framework = unity
test_port = /dev/cu.usbmodem1201
test_speed = 115200
test_filter = *
build_src_filter = +<*> -<main.cpp>
test_build_src = yes
test_ignore = test_integration_* 
debug_test = *
debug_build_flags = -O0 -g3 -ggdb

; ========================================
; DISTRIBUTION BUILD ENVIRONMENTS
; ========================================
; These environments are used for building firmware for distribution
; They use clean configs without secrets and output to /firmware/

[env:esp32c3]
platform = espressif32
board = esp32-c3-devkitc-02
framework = arduino
lib_deps = 
    arduino-libraries/NTPClient@^3.2.1
    ropg/ezTime@^0.8.3
    bblanchon/ArduinoJson@^6.21.3
    knolleary/PubSubClient@^2.8
    thijse/ArduinoLog@^1.1.1
    me-no-dev/AsyncTCP@^1.1.1
    https://github.com/me-no-dev/ESPAsyncWebServer.git
    fastled/FastLED@^3.7.8
monitor_speed = 115200
upload_speed = 460800
build_flags = 
    -std=gnu++17
    -DCORE_DEBUG_LEVEL=1
    -DBOARD_HAS_PSRAM=0
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DFIRMWARE_VERSION=\"1.0.0\"
    -DASYNC_TCP_SSL_ENABLED=0
    -DCONFIG_ASYNC_TCP_MAX_ACK_TIME=3000
    -DCONFIG_ASYNC_TCP_PRIORITY=10
    -DCONFIG_ASYNC_TCP_QUEUE_SIZE=32
    -DASYNCWEBSERVER_REGEX=1
    -DENABLE_LEDS=1
    -DDISABLE_OTA=1
    -Os
    -ffunction-sections
    -fdata-sections
    -DARDUINOJSON_USE_LONG_LONG=0
build_unflags = 
    -O2
    -std=gnu++11
    -std=c++11
    -std=c++17
board_build.filesystem = littlefs
board_build.partitions = partitions_no_ota.csv

[env:esp32c3-no-leds]
platform = espressif32
board = esp32-c3-devkitc-02
framework = arduino
lib_deps = 
    arduino-libraries/NTPClient@^3.2.1
    ropg/ezTime@^0.8.3
    bblanchon/ArduinoJson@^6.21.3
    knolleary/PubSubClient@^2.8
    thijse/ArduinoLog@^1.1.1
    me-no-dev/AsyncTCP@^1.1.1
    https://github.com/me-no-dev/ESPAsyncWebServer.git
monitor_speed = 115200
upload_speed = 460800
build_flags = 
    -std=gnu++17
    -DCORE_DEBUG_LEVEL=1
    -DBOARD_HAS_PSRAM=0
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DFIRMWARE_VERSION=\"1.0.0\"
    -DASYNC_TCP_SSL_ENABLED=0
    -DCONFIG_ASYNC_TCP_MAX_ACK_TIME=3000
    -DCONFIG_ASYNC_TCP_PRIORITY=10
    -DCONFIG_ASYNC_TCP_QUEUE_SIZE=32
    -DASYNCWEBSERVER_REGEX=1
    -DENABLE_LEDS=0
    -DDISABLE_OTA=1
    -Os
    -ffunction-sections
    -fdata-sections
    -DARDUINOJSON_USE_LONG_LONG=0
build_unflags = 
    -O2
    -std=gnu++11
    -std=c++11
    -std=c++17
board_build.filesystem = littlefs
board_build.partitions = partitions_no_ota.csv

[env:lolin32lite]
platform = espressif32
board = lolin32
framework = arduino
lib_deps = 
    arduino-libraries/NTPClient@^3.2.1
    ropg/ezTime@^0.8.3
    bblanchon/ArduinoJson@^6.21.3
    knolleary/PubSubClient@^2.8
    thijse/ArduinoLog@^1.1.1
    me-no-dev/AsyncTCP@^1.1.1
    https://github.com/me-no-dev/ESPAsyncWebServer.git
monitor_speed = 115200
upload_speed = 460800
build_flags = 
    -std=gnu++17
    -DCORE_DEBUG_LEVEL=1
    -DBOARD_HAS_PSRAM=0
    -DFIRMWARE_VERSION=\"1.0.0\"
    -DASYNC_TCP_SSL_ENABLED=0
    -DCONFIG_ASYNC_TCP_MAX_ACK_TIME=3000
    -DCONFIG_ASYNC_TCP_PRIORITY=10
    -DCONFIG_ASYNC_TCP_QUEUE_SIZE=32
    -DASYNCWEBSERVER_REGEX=1
    -DENABLE_LEDS=0
    -DDISABLE_OTA=1
    -Os
    -ffunction-sections
    -fdata-sections
    -DARDUINOJSON_USE_LONG_LONG=0
build_unflags = 
    -O2
    -std=gnu++11
    -std=c++11
    -std=c++17
board_build.filesystem = littlefs
board_build.partitions = partitions_no_ota.csv